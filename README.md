# NBA Data Analysis

This project involves analyzing NBA player data, converting city names to geographic coordinates, and storing the data in MongoDB. Additionally, it integrates API requests for annual temperature, cost of living, and tax rates for the cities where players have moved.

## Project Structure

nba_analysis/
├── data/

│ └── Players that fit Query - Final List.csv

├── scripts/

│ └── update_and_import.py

├── venv/

├── README.md


## Prerequisites

- Python 3.10 or later
- MongoDB

## Setup Instructions

### 1. Clone the Repository

Clone this repository to your local machine.

```sh
git clone https://github.com/danceswithme/nba_analysis.git
cd nba_analysis
```

2. Create and Activate a Virtual Environment
On Windows
Create the Virtual Environment:

```sh
python -m venv venv
```

Activate the Virtual Environment:
```
venv\Scripts\activate
```

3. Install Required Packages
With the virtual environment activated, install the necessary packages:
```sh
pip install pandas requests pymongo openpyxl
```

4. Ensure MongoDB is Running
Make sure MongoDB is running. You can start the MongoDB service by typing:
```sh
net start MongoDB
```

5. Running the Script
Navigate to the Script Directory:
```sh
cd scripts
```

Run the Script:
```sh
python update_and_import.py
```

## Project Overview
This repository contains CSV and Excel files sourced from basketball-reference.com. The data includes player statistics based on specific criteria listed in the first sheet of the players_that_fit_query.xlsx file.

## Data Source
The CSV and Excel files were generated by conducting lookups on basketball-reference.com. Players were selected based on predefined criteria detailed in the first sheet of the players_that_fit_query.xlsx.

## File Descriptions
players_that_fit_query.xlsx: Excel file containing detailed criteria and the list of players who meet those criteria sourced from basketball-reference.com.
players_data.csv: CSV file with aggregated statistics of players meeting the specified criteria.


## API Requests for Additional Data
The update_and_import.py script integrates API requests to gather the following information for cities involved in player movements:
update_city_state.py to add state abbreviations

Annual Temperature: Retrieves annual average temperature data for the cities.
annual_temperature_lookup.py searches open-meteo for average temperature of the cities and their given years
finish_temperature.py 

Cost of Living: Fetches cost of living indices for comparing living expenses between states.
insert_pci_data.py - collects per capita income (PCI) for all US states and adds to MongoDB
insert_toronto_pci.py - collects PCI for Toronto to add to MongoDB
update_pci_data.py - updates the player_movements collection with PCI for the states in the player documents

Tax Rate: Obtains tax rate information to understand financial implications.
Script Details
The script performs the following tasks:

Reads the Excel file Players that fit Query.xls from the data/ directory.
Extracts hyperlinks from the player names and adds them to the DataFrame.
Converts city names to geographic coordinates (latitude and longitude).
Adds the coordinates to the DataFrame.
Makes API requests to fetch annual temperature, cost of living, and tax rate data for each city.
Saves the updated DataFrame to a new CSV file Players that fit Query - Final List.csv in the data/ directory.
Inserts the updated data into the MongoDB database.
Notes
Ensure that the Excel file is named Players that fit Query.xls and the sheet is named Final List.
Make sure the CSV file is named Players that fit Query - Final List.csv.
Adjust the file paths in the script if your directory structure differs.
Contributing
Feel free to submit issues or pull requests if you have any improvements or fixes.

License
This project is licensed under the MIT License.
